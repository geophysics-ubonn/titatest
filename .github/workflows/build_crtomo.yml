name: Build Debian image using github actions

permissions:
  contents: write

on:
  workflow_dispatch:

jobs:
  build_crtomo:
    runs-on: ubuntu-22.04
    steps:
    - uses: actions/checkout@v3

    - name: ls1
      run: ls

    - name: Install dependencies
      run: sudo apt -y update && sudo apt install autotools-dev gfortran dpkg-dev automake autoconf debhelper

    - name: Prepare configuration files
      run: CRT_PREFIX="stable" ./autogen.sh

    - name: Run configure
      run: ./configure

    - name: Build
      run: make -j 2

    - name: Build debian package
      run: ./prep_deb_package.sh

    - name: ls1
      run: |
          ls src/
          ls cutmckee/
          ls package/

    - name: Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: CRTomo_binaries
        path: |
            src/CRMod_stable
            src/CRTomo_stable
